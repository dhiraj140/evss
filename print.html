<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Election Results - Print View</title>
    <link rel="stylesheet" href="css/print.css">
</head>
<body>
    <div class="print-container">
        <div class="print-watermark">Demo Digital EVM System</div>
        
        <header class="print-header">
            <h1>Election Results</h1>
            <h2 id="print-election-title">General Election 2024</h2>
            <div class="print-info">
                <p><strong>Date:</strong> <span id="print-date">Loading...</span></p>
                <p><strong>Time:</strong> <span id="print-time">Loading...</span></p>
                <p><strong>Total Votes:</strong> <span id="print-total-votes">0</span></p>
            </div>
        </header>
        
        <main class="print-main">
            <div class="print-winner">
                <h3>Leading Candidate</h3>
                <div class="print-winner-card">
                    <div class="print-winner-symbol" id="print-winner-symbol">üèÜ</div>
                    <div class="print-winner-details">
                        <h4 id="print-winner-name">No votes cast yet</h4>
                        <p id="print-winner-party">No results available</p>
                        <div class="print-winner-stats">
                            <span id="print-winner-votes">0 votes</span>
                            <span id="print-winner-percentage">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="print-table">
                <h3>Detailed Results</h3>
                <table id="print-results-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Candidate</th>
                            <th>Party</th>
                            <th>Symbol</th>
                            <th>Votes</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody id="print-results-table-body">
                        <!-- Results will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <div class="print-footer">
                <p class="print-disclaimer">Demo Digital EVM System ‚Äì For Educational and Practice Use Only. Not for real government elections.</p>
                <p>Generated on: <span id="print-generation-time">Loading...</span></p>
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        // Load results data and populate print page
        document.addEventListener('DOMContentLoaded', function() {
            const electionData = JSON.parse(localStorage.getItem('electionData')) || {};
            const candidates = electionData.candidates || [];
            const election = electionData.election || {};
            
            // Set election title
            document.getElementById('print-election-title').textContent = election.title || 'General Election 2024';
            
            // Set date and time
            const now = new Date();
            document.getElementById('print-date').textContent = now.toLocaleDateString();
            document.getElementById('print-time').textContent = now.toLocaleTimeString();
            document.getElementById('print-generation-time').textContent = now.toLocaleString();
            
            // Calculate total votes
            const totalVotes = candidates.reduce((sum, candidate) => sum + (candidate.votes || 0), 0);
            document.getElementById('print-total-votes').textContent = totalVotes;
            
            // Sort candidates by votes
            const sortedCandidates = [...candidates].sort((a, b) => (b.votes || 0) - (a.votes || 0));
            
            // Populate table
            const tableBody = document.getElementById('print-results-table-body');
            tableBody.innerHTML = '';
            
            sortedCandidates.forEach((candidate, index) => {
                const voteCount = candidate.votes || 0;
                const percentage = totalVotes > 0 ? ((voteCount / totalVotes) * 100).toFixed(2) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${candidate.name || 'Unknown'}</td>
                    <td>${candidate.party || 'Independent'}</td>
                    <td>${candidate.symbol || '‚ö™'}</td>
                    <td>${voteCount}</td>
                    <td>${percentage}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Show winner if available
            if (sortedCandidates.length > 0 && totalVotes > 0) {
                const winner = sortedCandidates[0];
                const winnerVotes = winner.votes || 0;
                const winnerPercentage = totalVotes > 0 ? ((winnerVotes / totalVotes) * 100).toFixed(2) : 0;
                
                document.getElementById('print-winner-name').textContent = winner.name || 'Unknown';
                document.getElementById('print-winner-party').textContent = winner.party || 'Independent';
                document.getElementById('print-winner-symbol').textContent = winner.symbol || 'üèÜ';
                document.getElementById('print-winner-votes').textContent = `${winnerVotes} votes`;
                document.getElementById('print-winner-percentage').textContent = `${winnerPercentage}%`;
            }
            
            // Auto-print after a short delay
            setTimeout(() => {
                window.print();
            }, 500);
        });
    </script>
</body>
</html>
